<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orders — Kira's BloomCraft</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family:'Poppins',sans-serif; background:#fff8f5; margin:0; padding:2rem; }
  h1 { color:#FF7043; margin-bottom:1rem; }
  .order-card { background:#fff; border-radius:12px; padding:1rem; margin-bottom:1rem; box-shadow:0 4px 12px rgba(255,140,105,0.2); position: relative; }
  .order-card h3 { margin-bottom:0.5rem; }
  .order-card p { margin:0.3rem 0; }
  select { padding:0.4rem 0.6rem; border-radius:6px; border:1px solid #ccc; margin-top:0.5rem; }
  .remove-btn { position:absolute; top:1rem; right:1rem; padding:0.3rem 0.6rem; border:none; border-radius:6px; background:#e74c3c; color:#fff; cursor:pointer; font-weight:bold; }
  .remove-btn:hover { background:#c0392b; }
  .back-btn { display:inline-block; margin-bottom:1rem; padding:0.5rem 1rem; background:#FF7043; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:bold; text-decoration:none; transition: all 0.3s; }
  .back-btn:hover { background:#f4511e; }
  .receipt { margin-top:0.5rem; }
  .receipt img { max-width:120px; border-radius:8px; cursor:pointer; border:1px solid #ccc; margin:3px; transition: transform 0.3s ease; }
  .receipt img:hover { transform: scale(1.1); }
</style>
</head>
<body>

<a href="admin.html" class="back-btn">← Back to Dashboard</a>

<h1>All Orders</h1>
<div id="ordersContainer">Loading orders...</div>

<script>
const ordersContainer = document.getElementById("ordersContainer");
let orders = JSON.parse(localStorage.getItem("orders")) || [];

function renderOrders() {
  if(orders.length === 0) {
    ordersContainer.innerHTML = "<p>No orders found.</p>";
    return;
  }

  ordersContainer.innerHTML = orders.map(order => {
    const itemsHtml = order.items.map(i => `${i.qty} × ${i.name} — ₱${(i.price*i.qty).toFixed(2)}`).join("<br>");
    const statusOptions = ["Pending Confirmation","Order Confirmed","Being Prepared","Out for Delivery","Delivered","Cancelled"]
      .map(s => `<option value="${s}" ${order.status===s?'selected':''}>${s}</option>`).join("");

    // Handle multiple receipts if present
    const receipts = order.receipts && order.receipts.length 
      ? order.receipts.map(r => `<img src="${r}" alt="Receipt">`).join("") 
      : order.receipt ? `<img src="${order.receipt}" alt="Receipt">` : "";

    const receiptsHtml = receipts ? `<div class="receipt"><strong>Receipt(s):</strong><br>${receipts}</div>` : "";

    return `<div class="order-card" data-id="${order.id}">
      <h3>Order ID: ${order.id}</h3>
      <p><strong>Name:</strong> ${order.buyerName || 'N/A'}</p>
      <p><strong>Contact:</strong> ${order.buyerContact || 'N/A'}</p>
      <p><strong>Placed On:</strong> ${order.createdAt}</p>
      <p><strong>Items:</strong><br>${itemsHtml}</p>
      <p><strong>Status:</strong>
        <select class="status-select" data-id="${order.id}">
          ${statusOptions}
        </select>
      </p>
      ${receiptsHtml}
      <button class="remove-btn" data-id="${order.id}">Remove</button>
    </div>`;
  }).join("");

  // Status change listener
  document.querySelectorAll(".status-select").forEach(sel => {
    sel.addEventListener("change", () => {
      const order = orders.find(o => o.id == sel.dataset.id);
      if(order){
        order.status = sel.value;
        localStorage.setItem("orders", JSON.stringify(orders));
      }
    });
  });

  // Remove order listener
  document.querySelectorAll(".remove-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      if(confirm(`Are you sure you want to remove Order ${btn.dataset.id}?`)){
        orders = orders.filter(o => o.id != btn.dataset.id);
        localStorage.setItem("orders", JSON.stringify(orders));
        renderOrders();
      }
    });
  });
}

// Initial render
renderOrders();

// Live update if another admin changes status or removes an order
window.addEventListener("storage", e => {
  if(e.key === "orders"){
    orders = JSON.parse(e.newValue || "[]");
    renderOrders();
  }
});
</script>

</body>
</html>
